# WikiFX AI 搜索方案规划（逐步落地）

本文面向 WikiFX 搜索升级：在现有“交易商 / 自营交易商 / 企业 / 官方号 / 内容 / 用户 / 区块”等垂类基础上，逐步引入 AI 搜索与 Agent 编排能力。

- 线上现状示例：`https://www.wikifx.com/zh-cn/search.html?keyword=xm&SearchPosition=1&scene=1`
- 本文输出：
  1) 深度调研与可搜内容边界；2) 最佳实践与方案评估；3) 模块拆分规划；
  4) 第一期（P0）“意图识别-导航代理”方案与 Demo；5) 产品全景架构图与路线图。

---

## 1. 深度调研：现状与可扩展的可搜索内容

- 现状（从用户视角归纳）
  - 搜索对象类：
    - 交易商：品牌实体、牌照、监管状态、评分、风控标签
    - 自营交易商：WikiFX 体系内自营主体（如有）
    - 企业：法定主体、股权结构、法人、历史变更、关联公司
    - 官方号：官网、官微、社媒账号、公告
    - 内容：新闻、测评、曝光/投诉、教程、问答
    - 用户：用户主页、发帖、互动、信誉
    - 区块：链上地址、交易哈希、归因、告警
  - 结果表现：列表页（可分页、可筛选），缺少“高意图快速直达”。

- 未来可搜（建议扩展维度）
  - 交易商画像：点差、滑点、交易时段、品种、账户类型、杠杆、出入金渠道、手续费
  - 合规与风险：多辖区牌照、处罚记录、风险预警、历史事件时间线
  - 对比与推荐：双/多商对比、基于画像的个性化推荐（如“低点差”偏好）
  - 投诉与维权：投诉聚合、进展、处置方案、办结率
  - 社区与舆情：热点话题、口碑趋势、KOL点评
  - 区块追踪：疑似关联地址、出入金模式、链上异常告警
  - 任务式检索：
    - “比较 A 和 B 谁更适合剥头皮？”
    - “X 是否受监管？有哪些牌照？最新状态？”
    - “最近一个月有关 X 的投诉有哪些？”

---

## 2. 最佳实践：AI 搜索与 Agent 的通用做法

- 行业标杆与可借鉴特性
  - Perplexity/Kagi：多来源检索 + 引用溯源 + 即问即答
  - Bing Copilot/Google SGE：混合检索（网页+结构化），多意图分桶展示
  - 电商/本地生活搜索：强导航（类目优先）、意图卡片、动态筛选
  - 知识图谱：实体识别与对齐，支持结构化查询与聚合

- 通用方法论（可落地）
  - 查询理解：语言检测、拼写纠错、实体识别、意图分类、改写与扩写
  - 召回：
    - 结构化检索（SQL/DSL/图查询）
    - 语义检索（向量召回 + 召回多路）
    - 垂类召回器（交易商/企业/内容/区块）
  - 重排：BM25 + 语义重排 + 业务打分（新鲜度/合规/可信度）
  - 生成：摘要、Card 化答案、可解释的来源引用
  - Agent 编排：工具路由、子任务拆解、多跳行动（如“先查牌照，再对比点差”）
  - 评估：线上 A/B、SxS 评测、满意度、零结果率、长尾召回覆盖

---

## 3. 模块拆分与规划

- 查询理解模块
  - 语言检测、标准化
  - 实体识别（交易商/企业/用户/地址）
  - 意图分类（导航、比较、监管、投诉、资金、官方、区块、内容）
  - 纠错与改写（同义词、品牌别名）

- 路由与编排模块
  - 决策策略：基于置信度的路由（导航 vs. 回答）、多意图多卡片并列
  - 工具与数据源：
    - 结构化：牌照库、工商库、交易商画像库
    - 非结构化：文章、帖子、公告、社媒
    - 向量库：内容语义索引

- 召回与重排模块
  - 多路召回：BM25、ANN、Graph 邻接召回
  - 语义重排：跨源统一排序
  - 业务因子：合规优先、新鲜度、可信度、地域相关

- 生成与展示模块
  - 卡片化结果（监管、资金、对比、投诉）
  - 生成摘要 + 引用溯源
  - 风险与合规提示（显式标注生成内容）

- 评估与观测模块
  - 埋点：查询分布、CTR、零结果率、跳出率、二跳率
  - 评测集：人工标注意图 + 召回、排序对拍
  - 安全与合规：敏感词、虚假信息防护、对抗输入

---

## 4. 第一期（P0）方案：意图识别 + 导航代理

- 目标
  - 在不改动现有搜索后端的前提下，优先实现“强导航”：用户可一跳直达最相关的类别结果页
  - 降低零结果率、缩短完成任务时间，显著提升 CTR

- 能力边界
  - 意图分类：导航/比较/监管/资金/官方/企业/区块/投诉/内容
  - 交易商实体识别：品牌别名归一
  - 导航策略：选择最可能的类别 + 提供直达链接 + 候选列表

- API 契约（建议，供线上实现）
```json
POST /api/ai-search/navigate
{
  "query": "xm 出金",
  "lang": "zh-CN",
  "scopes": ["交易商", "内容"],
  "userId": "optional"
}
---
{
  "intent": "funding",
  "targetType": "交易商",
  "targetEntity": { "type": "交易商", "name": "XM", "id": "xm" },
  "confidence": 0.83,
  "actions": [
    { "label": "打开 WikiFX 搜索", "url": "https://...keyword=xm 出金" },
    { "label": "直达交易商：XM", "url": "https://...keyword=xm" }
  ],
  "alternatives": [
    { "targetType": "内容", "url": "https://...keyword=xm 出金 教程" }
  ],
  "reason": "包含出入金关键词，且识别到交易商 XM"
}
```

- 识别策略（P0 实现路径）
  1) 规则优先：关键词 + 同义词词典 + 实体词典（品牌别名对齐）
  2) 模型兜底：轻量中文分类器（如 BERT-mini/ERNIE-tiny）+ 零样本提示
  3) 置信度门控：低于阈值回退到普通搜索

- 前端集成
  - 在现有搜索页顶部，新增“AI 导航条”与推荐跳转（可 A/B 实验）
  - 点击后以新标签打开对应结果页；提供相似查询建议

- 可视化 Demo
  - 见仓库根目录 `index.html`。本地使用规则模拟服务端效果。

---

## 5. 产品全景架构图（含请求流）

```mermaid
flowchart LR
  subgraph Client[Web/APP]
    Q[用户查询]
    UI[AI 导航条]
  end

  subgraph AI_Gateway[AI Search Gateway]
    QN[查询理解\n语言/纠错/实体/意图]
    ROUTER[路由与编排]
  end

  subgraph Retrieval[召回与索引]
    STR[结构化检索\n(牌照/工商/画像)]
    SEM[语义检索\n向量库]
    CNT[内容检索\n文章/帖子/公告]
    G[知识图谱/关系]
  end

  subgraph Rank[重排与融合]
    R1[BM25/语义重排]
    R2[业务打分]
  end

  subgraph Gen[生成与合规]
    LLM[LLM 摘要/解释]
    SAFE[安全与合规]
  end

  Q --> UI --> QN --> ROUTER
  ROUTER --> STR
  ROUTER --> SEM
  ROUTER --> CNT
  ROUTER --> G
  STR --> R1
  SEM --> R1
  CNT --> R1
  G --> R1
  R1 --> R2 --> ROUTER
  ROUTER -->|高置信度导航| UI
  ROUTER -->|需要回答| LLM --> SAFE --> UI
```

---

## 6. 路线图（建议）

- 阶段 P0（2-3 周）
  - 意图分类 + 导航代理（规则 + 轻模型）
  - 前端导航条接入、埋点、A/B 实验

- 阶段 P1（4-6 周）
  - 语义检索接入（向量库）与统一重排
  - 卡片化答案（监管、资金、投诉）+ 引用溯源

- 阶段 P2（6-10 周）
  - Agent 工具化：对比、牌照核验、资金渠道解析、投诉聚合
  - 多跳任务（先查实体，再调用垂类工具）

- 阶段 P3（持续）
  - 个性化与长期记忆、用户画像驱动排序
  - 多语种与跨区域扩展

---

## 7. 评估指标与埋点

- 效率：首击时间（TTFR）、完成任务时间（TTTC）
- 效能：CTR、二跳率、零结果率下降幅度
- 质量：人工标注意图准确率、召回@K、NDCG@K
- 体验：满意度问卷、差评率、撤回率
- 安全：敏感/不当文本拦截率、事实性纠错反馈

---

## 8. 风险与合规

- 生成内容声明与显著标注，避免误导
- 合规优先排序（持牌、处罚记录、风险提示）
- 保护用户隐私与账号安全，避免过度个性化
- 防御对抗样本与恶意提示注入

---

## 9. 技术选型（建议）

- 查询理解：轻量 BERT/ERNIE + 规则字典；后续蒸馏到 FP16/INT8
- 语义检索：FAISS/HNSW + 句向量（bge-m3/bge-small-zh）
- 重排：Cross-Encoder（e.g., mMarco 中文蒸馏）
- 生成：LLM（带系统提示 + 检索增强 RAG）
- 观测：OpenTelemetry + ClickHouse 指标库

---

附：本仓库 Demo 演示了 P0 关键路径（意图识别 + 导航代理）。上线实现时，请替换为服务端 API 并补全召回/重排与埋点。 